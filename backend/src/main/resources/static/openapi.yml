openapi: 3.0.1
info:
  title: API de Ventas
  description: API para gestión de ventas, cotizaciones, clientes, productos, descuentos y vendedores
  version: 1.0.0
servers:
  - url: http://localhost:8080
    description: Servidor de Desarrollo
  - url: https://mod-ventas.onrender.com
    description: Servidor de Producción

tags:
  - name: Ventas
    description: Operaciones relacionadas con ventas
  - name: Cotizaciones
    description: Operaciones relacionadas con cotizaciones
  - name: Clientes
    description: Gestión de clientes
  - name: Productos
    description: Gestión de productos
  - name: Vendedores
    description: Gestión de vendedores
  - name: Descuentos
    description: Gestión de descuentos

paths:
  /api/venta:
    get:
      tags:
        - Ventas
      summary: Listar todas las ventas
      description: Obtiene un listado de todas las ventas registradas en el sistema
      operationId: listarVentas
      responses:
        '200':
          description: Lista de ventas obtenida exitosamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/VentaListadoResponse'
        '500':
          description: Error interno del servidor

  /api/venta/directa/borrador:
    post:
      tags:
        - Ventas
      summary: Crear una venta directa en borrador
      description: Crea una nueva venta directa en estado borrador con código generado automáticamente (VTA-DIR-XXXXXX)
      operationId: crearVentaDirectaBorrador
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CrearVentaDirectaRequest'
      responses:
        '201':
          description: Venta directa borrador creada exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VentaResumenResponse'
        '400':
          description: Datos de entrada inválidos
        '500':
          description: Error interno del servidor

  /api/venta/{ventaId}/carrito:
    get:
      tags:
        - Ventas
      summary: Obtener resumen del carrito de venta
      description: Obtiene el resumen completo de una venta incluyendo sus items, subtotales y totales
      operationId: obtenerResumen
      parameters:
        - name: ventaId
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: ID de la venta
      responses:
        '200':
          description: Resumen de la venta obtenido exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VentaResumenResponse'
        '404':
          description: Venta no encontrada
        '500':
          description: Error interno del servidor

  /api/venta/{ventaId}/carrito/items:
    post:
      tags:
        - Ventas
      summary: Agregar item al carrito de venta
      description: Agrega un producto al carrito de una venta. Si el producto ya existe, incrementa la cantidad. Recalcula automáticamente los totales.
      operationId: agregarItem
      parameters:
        - name: ventaId
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: ID de la venta
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AgregarItemVentaRequest'
      responses:
        '200':
          description: Item agregado exitosamente al carrito
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VentaResumenResponse'
        '400':
          description: Datos de entrada inválidos o venta no está en borrador
        '404':
          description: Venta o producto no encontrado
        '500':
          description: Error interno del servidor

  /api/cotizaciones:
    get:
      tags:
        - Cotizaciones
      summary: Listar todas las cotizaciones
      operationId: listarCotizaciones
      responses:
        '200':
          description: Lista de cotizaciones obtenida exitosamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Cotizacion'
    post:
      tags:
        - Cotizaciones
      summary: Crear una nueva cotización
      operationId: crearCotizacion
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CotizacionRequest'
      responses:
        '201':
          description: Cotización creada exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cotizacion'

  /api/cotizaciones/{id}:
    get:
      tags:
        - Cotizaciones
      summary: Obtiene los detalles de una cotización específica.
      operationId: obtenerCotizacion
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID de la cotización a consultar.
      responses:
        '200':
          description: Detalles de la cotización.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cotizacion'
        '404':
          description: Cotización no encontrada.

  /api/cotizaciones/{id}/aceptacion:
    post:
      tags:
        - Cotizaciones
      summary: Registra la aceptación de una cotización por parte del cliente.
      description: Este endpoint es típicamente invocado desde un enlace seguro o un formulario después de que el cliente recibe el correo (acción asíncrona).
      operationId: aceptarCotizacion
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID de la cotización a aceptar.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token_aceptacion:
                  type: string
                  description: Token de seguridad para validar que la aceptación proviene del destinatario correcto.
      responses:
        '200':
          description: Cotización aceptada. Se inicia la generación de la orden de venta.
        '400':
          description: Token inválido o cotización ya aceptada/expirada.
        '404':
          description: Cotización no encontrada.

  /api/cotizaciones/enviar:
    post:
      tags:
        - Cotizaciones
      summary: Enviar cotización por email
      operationId: enviarCotizacion
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                cotizacionId:
                  type: integer
                  format: int64
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: Cotización enviada exitosamente
        '400':
          description: Datos inválidos
        '404':
          description: Cotización no encontrada

  # ==================== ENDPOINTS DE CLIENTES ====================
  /api/clientes/registroClientes:
    post:
      tags:
        - Clientes
      summary: Registrar nuevo cliente
      description: Crea un cliente nuevo validando DNI y deudas
      operationId: registrarCliente
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegistroClienteRequest'
      responses:
        '201':
          description: Cliente registrado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClienteResponse'
        '400':
          description: Datos inválidos o cliente no apto
        '409':
          description: DNI o email ya existe

  /api/clientes/actualizacionClientes/{id}:
    put:
      tags:
        - Clientes
      summary: Actualizar cliente
      description: Actualiza datos o cambia estado de un cliente
      operationId: actualizarCliente
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: ID del cliente a actualizar
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ModificacionClienteRequest'
      responses:
        '200':
          description: Cliente actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClienteResponse'
        '404':
          description: Cliente no encontrado
        '409':
          description: Email ya existe para otro cliente

  /api/clientes/filtroClientes:
    get:
      tags:
        - Clientes
      summary: Filtrar clientes
      description: Búsqueda paginada por criterios
      operationId: filtrarClientes
      parameters:
        - name: filtro
          in: query
          required: false
          schema:
            type: string
          description: Texto para buscar en DNI, nombre o email
        - name: estado
          in: query
          required: false
          schema:
            $ref: '#/components/schemas/EstadoClienteEnum'
          description: Estado del cliente (ACTIVO, INACTIVO)
        - name: page
          in: query
          schema:
            type: integer
            default: 0
          description: Número de página (inicia en 0)
        - name: size
          in: query
          schema:
            type: integer
            default: 10
          description: Cantidad de elementos por página
      responses:
        '200':
          description: Lista de clientes obtenida exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageClienteResponse'

  /api/clientes/HistorialCompras/{id}:
    get:
      tags:
        - Clientes
      summary: Historial de compras
      description: Obtiene detalle financiero del cliente
      operationId: obtenerHistorial
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: ID del cliente
      responses:
        '200':
          description: Historial obtenido exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HistorialComprasResponse'
        '404':
          description: Cliente no encontrado

  /api/clientes/{id}:
    delete:
      tags:
        - Clientes
      summary: Dar de baja cliente
      description: Desactiva un cliente validando que no tenga deudas ni equipos pendientes
      operationId: darBajaCliente
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: ID del cliente a dar de baja
      responses:
        '204':
          description: Cliente dado de baja exitosamente
        '404':
          description: Cliente no encontrado
        '400':
          description: Cliente tiene deudas o equipos pendientes

  # ==================== ENDPOINTS DE INTEGRACIÓN - ATENCIÓN AL CLIENTE ====================
  /api/clientes/integracion/atencion-cliente/{idCliente}:
    get:
      tags:
        - Clientes
      summary: Obtener cliente por ID
      description: Devuelve la información completa del cliente
      operationId: obtenerClientePorId
      parameters:
        - name: idCliente
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: ID del cliente
      responses:
        '200':
          description: Cliente encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClienteResponse'
        '404':
          description: Cliente no encontrado
    patch:
      tags:
        - Clientes
      summary: Actualizar cliente parcialmente
      description: Actualiza parcialmente los datos del cliente
      operationId: actualizarClienteParcial
      parameters:
        - name: idCliente
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: ID del cliente
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ModificacionClienteRequest'
      responses:
        '200':
          description: Cliente actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClienteResponse'
        '404':
          description: Cliente no encontrado

  # ==================== ENDPOINTS DE INTEGRACIÓN - MARKETING ====================
  /api/clientes/integracion/marketing:
    get:
      tags:
        - Clientes
      summary: Data para Marketing
      description: Retorna clientes con score y datos analíticos (RFM, demografía)
      operationId: obtenerDatosMarketing
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 0
        - name: size
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Datos de marketing obtenidos exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageMarketingClienteResponse'

  # ==================== ENDPOINTS DE INTEGRACIÓN - VENTAS ====================
  /api/clientes/integracion/ventas/buscar/{dni}:
    get:
      tags:
        - Clientes
      summary: Buscar cliente para venta
      description: Devuelve datos operativos y flag de deuda para realizar una venta
      operationId: buscarClienteParaVenta
      parameters:
        - name: dni
          in: path
          required: true
          schema:
            type: string
          description: DNI del cliente
      responses:
        '200':
          description: Cliente encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClienteVentaDTO'
        '404':
          description: Cliente no encontrado

  /api/clientes/integracion/ventas/crear:
    post:
      tags:
        - Clientes
      summary: Crear cliente simplificado
      description: Crea un cliente recibiendo datos básicos y devolviendo solo el ID generado
      operationId: crearClienteSimple
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CrearClienteSimpleRequest'
      responses:
        '201':
          description: Cliente creado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClienteIdResponse'
        '400':
          description: Datos inválidos o cliente no apto

  # ==================== ENDPOINTS DE DESCUENTOS ====================
  /api/descuentos/aplicar-mejor-descuento:
    post:
      tags:
        - Descuentos
      summary: Aplicar mejor descuento disponible
      description: Evalúa todas las reglas de descuento y aplica el que ofrece mayor beneficio
      operationId: aplicarMejorDescuento
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AplicarDescuentoRequest'
      responses:
        '200':
          description: Descuento aplicado exitosamente o no se aplicó ninguno
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DescuentoAplicadoResponse'
        '400':
          description: Datos inválidos, venta no encontrada o cliente no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DescuentoAplicadoResponse'

  # ==================== ENDPOINTS DE VENDEDORES ====================

  /api/vendedores:
    get:
      tags:
        - Vendedores
      summary: Busca y lista vendedores con filtros y paginación
      description: Permite buscar vendedores por tipo, estado, sede o DNI.
      operationId: searchSellers
      parameters:
        - name: sellerType
          in: query
          schema:
            $ref: '#/components/schemas/SellerTypeEnum'
          description: Filtro por tipo de vendedor (INTERNAL o EXTERNAL)
        - name: sellerStatus
          in: query
          schema:
            $ref: '#/components/schemas/SellerStatusEnum'
          description: Filtro por estado del vendedor (ACTIVE o INACTIVE)
        - name: sellerBranchId
          in: query
          schema:
            type: integer
            format: int64
          description: Filtro por ID de la sede asignada
        - name: dni
          in: query
          schema:
            type: string
          description: Búsqueda parcial por DNI
        - name: page
          in: query
          schema:
            type: integer
            default: 0
        - name: size
          in: query
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: Página de Vendedores obtenida exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VendedorPageResponse' # Usamos un Page<VendedorResponse>
    post:
      tags:
        - Vendedores
      summary: Registra un nuevo vendedor (Interno o Externo)
      operationId: createSeller
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegistroVendedorRequest'
      responses:
        '201':
          description: Vendedor creado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VendedorResponse'
        '400':
          description:
            Error de validación (ej: DNI ya registrado, Sede no asignada)
    put:
      tags:
        - Vendedores
      summary: Modifica la información de un vendedor existente
      operationId: updateSeller
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: ID del vendedor a modificar
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ModificacionVendedorRequest'
      responses:
        '200':
          description: Vendedor actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VendedorResponse'
        '404':
          description: Vendedor no encontrado

    /api/vendedores/activos:
      get:
        tags:
          - Vendedores
        summary: Lista todos los vendedores activos
        description: Útil para cargar dropdowns en otros módulos.
        operationId: listActiveSellers
        responses:
          '200':
            description: Lista de vendedores activos obtenida exitosamente
            content:
              application/json:
                schema:
                  type: array
                  items:
                    $ref: '#/components/schemas/VendedorResponse'

    /api/vendedores/{id}:
      get:
        tags:
          - Vendedores
        summary: Obtiene un vendedor por ID
        description: Obtiene los datos de un vendedor específico. Este endpoint también valida si el vendedor está activo para realizar ventas.
        operationId: getSellerById
        parameters:
          - name: id
            in: path
            required: true
            schema:
              type: integer
              format: int64
            description: ID del vendedor a buscar
        responses:
          '200':
            description: Vendedor encontrado y activo
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/VendedorResponse'
          '400':
            description: Vendedor encontrado pero INACTIVO (Bloqueo de negocio)
          '404':
            description: Vendedor no encontrado
      delete:
        tags:
          - Vendedores
        summary: Da de baja (desactiva) un vendedor
        operationId: deactivateSeller
        parameters:
          - name: id
            in: path
            required: true
            schema:
              type: integer
              format: int64
            description: ID del vendedor a desactivar
        responses:
          '204':
            description: Vendedor desactivado exitosamente (Sin contenido)
          '400':
            description: Bloqueado, el vendedor tiene cotizaciones pendientes
          '404':
            description: Vendedor no encontrado

    /api/vendedores/{id}/reactivar:
      post:
        tags:
          - Vendedores
        summary: Reactiva un vendedor inactivo
        operationId: reactivateSeller
        parameters:
          - name: id
            in: path
            required: true
            schema:
              type: integer
              format: int64
            description: ID del vendedor a reactivar
        responses:
          '200':
            description: Vendedor reactivado exitosamente
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/VendedorResponse'
          '400':
            description:
              Error de negocio (ej: Sede sin capacidad)
          '404':
            description: Vendedor no encontrado

    /api/vendedores/dni/{dni}:
      get:
        tags:
          - Vendedores
        summary: Busca un vendedor por DNI
        operationId: getSellerByDni
        parameters:
          - name: dni
            in: path
            required: true
            schema:
              type: string
            description: DNI del vendedor a buscar
        responses:
          '200':
            description: Vendedor encontrado
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/VendedorResponse'
          '404':
            description: Vendedor no encontrado

components:
  schemas:
    #VENDEDOR
    SellerTypeEnum:
      type: string
      enum: [ INTERNAL, EXTERNAL ]
    SellerStatusEnum:
      type: string
      enum: [ ACTIVE, INACTIVE ]
    DocumentTypeEnum:
      type: string
      enum: [ DNI, CE, PASSPORT, RUC ]
    BranchTypeEnum:
      type: string
      enum: [ MODULE, AUTHORIZED_DEALER, CALL_CENTER, CENTRO_DE_ATENCION ]

    # RESPONSE DEL VENDEDOR (DTO)
    VendedorResponse:
      type: object
      properties:
        sellerId:
          type: integer
          format: int64
        dni:
          type: string
          example: '12345678'
        firstName:
          type: string
        lastName:
          type: string
        fullName:
          type: string
          description: Nombre y Apellido concatenados
          example: Juan Pérez García
        email:
          type: string
          format: email
        phoneNumber:
          type: string
        address:
          type: string
        sellerType:
          $ref: '#/components/schemas/SellerTypeEnum'
        sellerStatus:
          $ref: '#/components/schemas/SellerStatusEnum'
        registrationDate:
          type: string
          format: date
        sellerBranchId:
          type: integer
          format: int64
        sellerBranchName:
          type: string
        employeeRrhhId:
          type: integer
          format: int64
          description: ID del empleado en el módulo RRHH (solo para INTERNAL)
        ruc:
          type: string
          description: RUC (solo para EXTERNAL)
        bankAccount:
          type: string
        bankName:
          type: string
        documentType:
          $ref: '#/components/schemas/DocumentTypeEnum'
        warehouseRefId:
          type: integer
          format: int64
          description: ID del almacén asociado a la sede (clave para Inventario)

    # REQUEST DE REGISTRO
    RegistroVendedorRequest:
      type: object
      required:
        - dni
        - sellerType
        - sellerBranchId
      properties:
        dni:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        email:
          type: string
          format: email
        phoneNumber:
          type: string
        address:
          type: string
        sellerType:
          $ref: '#/components/schemas/SellerTypeEnum'
        sellerBranchId:
          type: integer
          format: int64
        ruc:
          type: string
        bankAccount:
          type: string
        bankName:
          type: string
        documentType:
          $ref: '#/components/schemas/DocumentTypeEnum'

    # REQUEST DE MODIFICACIÓN
    ModificacionVendedorRequest:
      type: object
      properties:
        lastName:
          type: string
        email:
          type: string
          format: email
        phoneNumber:
          type: string
        address:
          type: string
        sellerBranchId:
          type: integer
          format: int64
          description: Nueva sede a asignar
        sellerStatus:
          $ref: '#/components/schemas/SellerStatusEnum'
        bankAccount:
          type: string
        bankName:
          type: string

    # ENTIDAD SEDE (RESPONSE)
    Sede:
      type: object
      properties:
        branchId:
          type: integer
          format: int64
        name:
          type: string
        address:
          type: string
        branchType:
          $ref: '#/components/schemas/BranchTypeEnum'
        maxCapacity:
          type: integer
          description: Capacidad máxima de vendedores (NULL para Call Center)
        active:
          type: boolean
          description: Estado de la sede (activa/inactiva)
        warehouseRefId:
          type: integer
          format: int64
          description: ID del almacén en el módulo de Inventario

    # OBJETO DE PAGINACIÓN DE SPRING (Simplificado)
    VendedorPageResponse:
      type: object
      description: Estructura de paginación de Spring Data
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/VendedorResponse'
        totalPages:
          type: integer
        totalElements:
          type: integer
        number:
          type: integer
          description: Número de página actual (cero basado)
        size:
          type: integer
          description: Tamaño de la página
        last:
          type: boolean
          description: Indica si es la última página
    # ENUMS DE VENTA
    OrigenVentaEnum:
      type: string
      enum: [DIRECTA, LEAD, COTIZACION]
      description: Origen de la venta
    VentaEstadoEnum:
      type: string
      enum: [BORRADOR, CONFIRMADA, CANCELADA]
      description: Estado de la venta

    # REQUEST DTOs
    CrearVentaDirectaRequest:
      type: object
      required:
        - usuarioCreador
      properties:
        usuarioCreador:
          type: string
          description: Usuario que crea la venta
          example: "admin@empresa.com"

    AgregarItemVentaRequest:
      type: object
      required:
        - itemProductoId
        - cantidad
      properties:
        itemProductoId:
          type: integer
          format: int64
          description: ID del producto a agregar
          example: 1
        cantidad:
          type: integer
          minimum: 1
          description: Cantidad del producto a agregar
          example: 2

    # RESPONSE DTOs
    VentaListadoResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: ID de la venta
          example: 1
        numVenta:
          type: string
          description: Número de venta generado
          example: "VTA-DIR-000001"
        origenVenta:
          $ref: '#/components/schemas/OrigenVentaEnum'
        estado:
          $ref: '#/components/schemas/VentaEstadoEnum'
        fechaVentaCreada:
          type: string
          format: date
          description: Fecha de creación de la venta
          example: "2025-12-03"
        nombreCliente:
          type: string
          nullable: true
          description: Nombre del cliente (null si no está asignado)
          example: "Juan Pérez"

    VentaResumenResponse:
      type: object
      properties:
        ventaId:
          type: integer
          format: int64
          description: ID de la venta
          example: 1
        origen:
          $ref: '#/components/schemas/OrigenVentaEnum'
        estado:
          $ref: '#/components/schemas/VentaEstadoEnum'
        subtotal:
          type: number
          format: decimal
          description: Subtotal de la venta (suma de items sin descuentos)
          example: 1500.00
        descuentoTotal:
          type: number
          format: decimal
          description: Total de descuentos aplicados
          example: 0.00
        total:
          type: number
          format: decimal
          description: Total final de la venta
          example: 1500.00
        items:
          type: array
          description: Lista de items en el carrito
          items:
            $ref: '#/components/schemas/LineaCarritoResponse'

    LineaCarritoResponse:
      type: object
      properties:
        detalleId:
          type: integer
          format: int64
          description: ID del detalle de venta
          example: 1
        itemProductoId:
          type: integer
          format: int64
          description: ID del producto
          example: 5
        nombreProducto:
          type: string
          description: Nombre del producto
          example: "Internet 100 Mbps"
        cantidad:
          type: integer
          description: Cantidad del producto
          example: 2
        precioUnitario:
          type: number
          format: decimal
          description: Precio unitario del producto
          example: 750.00
        subtotal:
          type: number
          format: decimal
          description: Subtotal de la línea (precioUnitario * cantidad - descuentos)
          example: 1500.00
    
    Cotizacion:
      type: object
      properties:
        id:
          type: integer
          format: int64
        fecha:
          type: string
          format: date-time
        clienteId:
          type: integer
          format: int64
        vendedorId:
          type: integer
          format: int64
        total:
          type: number
          format: double
        estado:
          type: string
          enum: [BORRADOR, ENVIADA, ACEPTADA, RECHAZADA, VENCIDA]
        vigencia:
          type: string
          format: date
        items:
          type: array
          items:
            $ref: '#/components/schemas/CotizacionItem'
    
    CotizacionRequest:
      type: object
      required:
        - clienteId
        - vendedorId
        - items
      properties:
        clienteId:
          type: integer
          format: int64
        vendedorId:
          type: integer
          format: int64
        vigencia:
          type: string
          format: date
        items:
          type: array
          items:
            $ref: '#/components/schemas/CotizacionItemRequest'
    
    CotizacionItem:
      type: object
      properties:
        id:
          type: integer
          format: int64
        productoId:
          type: integer
          format: int64
        cantidad:
          type: integer
        precioUnitario:
          type: number
          format: double
        subtotal:
          type: number
          format: double
    
    CotizacionItemRequest:
      type: object
      required:
        - productoId
        - cantidad
      properties:
        productoId:
          type: integer
          format: int64
        cantidad:
          type: integer
          minimum: 1

    # ==================== SCHEMAS DE CLIENTES ====================
    EstadoClienteEnum:
      type: string
      enum: [ACTIVO, INACTIVO]
      description: Estado del cliente

    RegistroClienteRequest:
      type: object
      required:
        - dni
        - firstName
        - lastName
      properties:
        dni:
          type: string
          description: DNI del cliente (8 dígitos)
          example: "12345678"
        firstName:
          type: string
          description: Nombre del cliente
          example: "Juan"
        lastName:
          type: string
          description: Apellido del cliente
          example: "Pérez"
        email:
          type: string
          format: email
          description: Email del cliente
          example: "juan.perez@email.com"
        phoneNumber:
          type: string
          description: Número de teléfono celular (9 dígitos)
          example: "987654321"
        telefonoFijo:
          type: string
          description: Número de teléfono fijo
          example: "555-1001"
        address:
          type: string
          description: Dirección del cliente
          example: "Av. Principal 123"
        fechaNacimiento:
          type: string
          format: date
          description: Fecha de nacimiento (usada para verificación de identidad)
          example: "1985-01-15"

    ModificacionClienteRequest:
      type: object
      properties:
        lastName:
          type: string
          description: Apellido del cliente
          example: "García"
        email:
          type: string
          format: email
          description: Email del cliente
          example: "nuevo.email@email.com"
        phoneNumber:
          type: string
          description: Número de teléfono (9 dígitos)
          example: "987654321"
        address:
          type: string
          description: Dirección del cliente
          example: "Calle Nueva 456"
        estado:
          $ref: '#/components/schemas/EstadoClienteEnum'

    ClienteResponse:
      type: object
      properties:
        clienteId:
          type: integer
          format: int64
        dni:
          type: string
          example: "12345678"
        firstName:
          type: string
          example: "Juan"
        lastName:
          type: string
          example: "Pérez"
        fullName:
          type: string
          description: Nombre completo del cliente
          example: "Juan Pérez"
        email:
          type: string
          format: email
          example: "juan.perez@email.com"
        phoneNumber:
          type: string
          example: "987654321"
        address:
          type: string
          example: "Av. Principal 123"
        registrationDate:
          type: string
          format: date
          description: Fecha de registro del cliente
          example: "2025-01-15"
        estado:
          type: string
          description: Estado del cliente
          example: "ACTIVO"
        categoria:
          type: string
          description: Categoría del cliente
          example: "Estándar"

    PageClienteResponse:
      type: object
      properties:
        clientes:
          type: array
          items:
            $ref: '#/components/schemas/ClienteResponse'
        currentPage:
          type: integer
          description: Página actual (cero basado)
          example: 0
        totalPages:
          type: integer
          description: Total de páginas
          example: 5
        totalElements:
          type: integer
          format: int64
          description: Total de elementos
          example: 50
        pageSize:
          type: integer
          description: Tamaño de la página
          example: 10

    HistorialComprasResponse:
      type: object
      properties:
        clienteId:
          type: integer
          format: int64
        clienteNombre:
          type: string
          example: "Juan Pérez"
        categoria:
          type: string
          example: "Estándar"
        totalCompras:
          type: number
          format: decimal
          description: Total acumulado de compras
          example: 5000.00
        cantidadCompras:
          type: integer
          description: Cantidad de compras realizadas
          example: 10
        compras:
          type: array
          items:
            type: object
            properties:
              compraId:
                type: integer
                format: int64
              fecha:
                type: string
                format: date
              producto:
                type: string
              monto:
                type: number
                format: decimal
              metodoPago:
                type: string

    # ==================== SCHEMAS DE DESCUENTOS ====================
    AplicarDescuentoRequest:
      type: object
      required:
        - ventaId
        - dniCliente
      properties:
        ventaId:
          type: string
          description: ID de la venta a la que se aplicará el descuento
          example: "1"
        dniCliente:
          type: string
          description: DNI del cliente para evaluar descuentos por tipo de cliente
          example: "12345678"
        codigoCupon:
          type: string
          description: Código de cupón promocional (opcional)
          example: "VERANO2024"

    DescuentoAplicadoResponse:
      type: object
      properties:
        tipoDescuento:
          type: string
          description: Tipo de descuento aplicado
          example: "TIPO_CLIENTE"
        montoDescontado:
          type: number
          format: decimal
          description: Monto descontado
          example: 150.00
        nuevoTotalVenta:
          type: number
          format: decimal
          description: Nuevo total de la venta después del descuento
          example: 1350.00
        mensaje:
          type: string
          description: Mensaje descriptivo del descuento aplicado
          example: "15% de descuento por ser cliente Platino"

    # ==================== SCHEMAS DE INTEGRACIÓN ====================
    CrearClienteSimpleRequest:
      type: object
      required:
        - dni
        - firstName
        - lastName
      properties:
        dni:
          type: string
          description: DNI del cliente
          example: "12345678"
        firstName:
          type: string
          description: Nombre del cliente
          example: "Juan"
        lastName:
          type: string
          description: Apellido del cliente
          example: "Pérez"
        email:
          type: string
          format: email
          description: Email del cliente
          example: "juan.perez@email.com"
        phoneNumber:
          type: string
          description: Número de teléfono
          example: "987654321"

    ClienteIdResponse:
      type: object
      properties:
        clienteId:
          type: integer
          format: int64
          description: ID del cliente creado
          example: 123

    ClienteVentaDTO:
      type: object
      properties:
        clienteId:
          type: integer
          format: int64
          example: 123
        dni:
          type: string
          example: "12345678"
        fullName:
          type: string
          description: Nombre completo del cliente
          example: "Juan Pérez"
        email:
          type: string
          format: email
          example: "juan.perez@email.com"
        phoneNumber:
          type: string
          example: "987654321"
        estado:
          type: string
          description: Estado del cliente
          example: "ACTIVO"
        tieneDeuda:
          type: boolean
          description: Indica si el cliente tiene deudas pendientes
          example: false
        puedeComprar:
          type: boolean
          description: Flag operativo que indica si el cliente puede realizar compras
          example: true

    PageMarketingClienteResponse:
      type: object
      properties:
        clientes:
          type: array
          items:
            $ref: '#/components/schemas/ClienteMarketingDTO'
        currentPage:
          type: integer
          description: Página actual (cero basado)
          example: 0
        totalPages:
          type: integer
          description: Total de páginas
          example: 5
        totalElements:
          type: integer
          format: int64
          description: Total de elementos
          example: 100
        pageSize:
          type: integer
          description: Tamaño de la página
          example: 20

    ClienteMarketingDTO:
      type: object
      properties:
        clienteId:
          type: integer
          format: int64
        dni:
          type: string
          example: "12345678"
        fullName:
          type: string
          example: "Juan Pérez"
        email:
          type: string
          format: email
          example: "juan.perez@email.com"
        categoria:
          type: string
          description: Categoría del cliente
          example: "Platino"
        estado:
          type: string
          description: Estado del cliente
          example: "ACTIVO"
        recencyScore:
          type: integer
          description: Días desde última compra (RFM - Recency)
          example: 15
        frequencyScore:
          type: integer
          description: Frecuencia de compras (RFM - Frequency)
          example: 8
        monetaryScore:
          type: number
          format: decimal
          description: Valor total de compras (RFM - Monetary)
          example: 5000.00
        ubicacion:
          type: string
          description: Ubicación del cliente
          example: "Lima"
        edad:
          type: integer
          description: Edad del cliente
          example: 35

